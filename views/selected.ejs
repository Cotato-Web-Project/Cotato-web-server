<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>게시글</title>
  </head>

  <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>


  <body>
    <h1 onclick="location.href='/'">게시글 목록</h1>
    <hr />
    <div>
      <div style="display: inline-block">
        <div>
          <% if(item.img) { %>
          <img
            src="data:item/<%=item.img.contentType%>;base64,
                     <%=item.img.data.toString('base64')%>"
            width="200px"
            height="200px"
          />
          <% }%>
          <div>
            <h5>제목 : <%= item.title %></h5>
            <p>내용 : <%= item.desc %></p>
            <p>조회수 : <%= item.views %></p>
          </div>
        </div>
        <button onclick="location.href='/updatePost/<%=item.id%>'">수정</button>
        <button class="delete" data-id="<%=item.id%>">삭제</button>
        <br>
        <p>
          <button onclick="location.href='/board/like/<%=item.id%>'">좋아요</button> 
          <%=item.liked%>
        </p>
        <a href="/uploads/<%=item.file.originalFileName%>" download>Download File</a>
       
        
      </div>
    </div>
    <hr />
    <h1>댓글작성</h1>
    <form action="/board/<%=item.id %>/createComment" method="POST">
      <div>
        <label> 내용: </label>
        <textarea id="text" name="comment" value="" rows="2"> </textarea>
      </div>
      <div>
        <button type="submit">Submit</button>
      </div>
    </form>
    <h1>댓글</h1>
    <% if(comment){ %> <% comment.forEach(function(data) { %>
    <p>
      <% if(data.isDeleted == false) {%> <%= data.text %> <%= data.createdAt %>
      <button onclick="location.href='/board/<%= data._id %>/deleteComment'">
        삭제
      </button>
      <button onclick="location.href='/board/<%= data._id %>/updatePage'">
        수정
      </button>
        <button onclick="location.href='/comment/like/<%=data._id%>'">좋아요</button> 
        <%=data.liked%>
      <h4>대댓글</h4>
      <form action = "/board/<%=data.id%>/replyComment" method = "POST">
        <div>
          <label>내용 :</label>
          <textarea name="comment" id="text" rows="3"></textarea>
        </div>
        <div>
          <button type="submit">SUbmit</button>
        </div>
      </form>
      <% } %>
    </p>
    <% }) %> <% } %>
  </body>

  <script>
    $(".delete").click(function(e) {
      $.ajax({
        method: "DELETE",
        url: "/deletePost",
        data: { id: e.target.dataset.id },
      })
        .always((result) => {
          console.log(e)
        }) 
    })
  </script>

</html>